@model PrivateTube.ViewModels.HomeViewModel

@{
    ViewData["Title"] = "Home";
}

<!-- Tag Bar / Categories (Visual Only for now) -->
<div class="tags-container"
    style="display: flex; gap: 12px; margin-bottom: 24px; overflow-x: auto; padding-bottom: 8px;">
    <span
        style="background: var(--text-color); color: var(--bg-color); padding: 6px 12px; border-radius: 8px; font-size: 14px; font-weight: 500; cursor: pointer;">All</span>
    @foreach (var p in Model.Playlists.Take(10))
    {
            <span
                style="background: var(--hover-bg); color: var(--text-color); padding: 6px 12px; border-radius: 8px; font-size: 14px; font-weight: 500; cursor: pointer; white-space: nowrap;">@p.Name</span>
    }
</div>

<div class="grid">
    @foreach (var video in Model.Videos)
    {
            <a asp-action="Watch" asp-route-id="@video.Id" class="video-card">
                <div class="thumbnail-container">
                    <img class="thumbnail" src="https://img.youtube.com/vi/@video.YouTubeVideoId/hqdefault.jpg"
                        loading="lazy" />
                    <div
                        style="position: absolute; bottom: 8px; right: 8px; background: rgba(0,0,0,0.8); color: white; padding: 2px 4px; font-size: 12px; border-radius: 4px;">
                        4:20</div> <!-- Mock Duration -->
                </div>
                <div class="details">
                    <div class="channel-icon">
                    @* Channel Icon (Placeholder) *@
                        <div
                            style="width: 100%; height: 100%; border-radius: 50%; background-color: #@((video.PlaylistId.GetHashCode() & 0xFFFFFF).ToString("X6"));">
                        </div>
                    </div>
                    <div class="meta">
                        <div class="title" title="@video.Title">@video.Title</div>
                        <div class="channel-name">@video.Playlist?.Name</div>
                        <div class="stats">
                            <span>10K views</span> • <span>@video.CreatedDate.ToString("MMM dd, yyyy")</span>
                        </div>
                    </div>
                </div>
            </a>
    }
</div>

@if (!Model.Videos.Any())
{
        <div style="text-align: center; margin-top: 50px; color: #aaa;">
            <p>No videos found.</p>
        </div>
}
else
{
        <div style="display: flex; justify-content: center; margin: 40px 0;">
            <button id="loadMoreBtn" onclick="loadMoreVideos()" style="background: var(--hover-bg); color: var(--text-color); border: 1px solid var(--border-color); padding: 10px 30px; border-radius: 20px; cursor: pointer; font-size: 14px; font-weight: 500;">Load More</button>
        </div>
}

<script>
    let page = 1;
    async function loadMoreVideos() {
        const btn = document.getElementById('loadMoreBtn');
        btn.innerText = 'Loading...';
        btn.disabled = true;

        try {
            const response = await fetch(`/Home/GetVideos?page=${page}`);
            const videos = await response.json();

            if (videos.length === 0) {
                btn.innerText = 'No more videos';
                return;
            }

            const grid = document.querySelector('.grid');
            videos.forEach(v => {
                const card = document.createElement('a');
                card.href = `/Home/Watch/${v.id}`;
                card.className = 'video-card';
                // Note: Simplified date formatting directly in JS or pass pre-formatted
                const date = new Date(v.createdDate).toLocaleDateString('en-US', { month: 'short', day: '2-digit', year: 'numeric' });
                const colorHex = (v.pHash & 0xFFFFFF).toString(16).padStart(6, '0');

                card.innerHTML = `
                    <div class="thumbnail-container">
                        <img class="thumbnail" src="https://img.youtube.com/vi/${v.youTubeVideoId}/hqdefault.jpg" loading="lazy" />
                        <div style="position: absolute; bottom: 8px; right: 8px; background: rgba(0,0,0,0.8); color: white; padding: 2px 4px; font-size: 12px; border-radius: 4px;">4:20</div>
                    </div>
                    <div class="details">
                        <div class="channel-icon">
                            <div style="width: 100%; height: 100%; border-radius: 50%; background-color: #${colorHex};"></div>
                        </div>
                        <div class="meta">
                            <div class="title" title="${v.title}">${v.title}</div>
                            <div class="channel-name">${v.playlistName}</div>
                            <div class="stats">
                                <span>10K views</span> • <span>${date}</span>
                            </div>
                        </div>
                    </div>
                `;
                grid.appendChild(card);
            });

            page++;
            btn.innerText = 'Load More';
            btn.disabled = false;
        } catch (error) {
            console.error('Error loading videos:', error);
            btn.innerText = 'Error loading';
        }
    }
</script>
